//v1.0.0
(function(u,q){function n(a,b){r(a)?this.form=a:"string"==typeof a?this.form=q.querySelector(a):logError("Please pass a valid element or selector");b||(b=p);if("object"===typeof b)for(var c in p)"undefined"===typeof b[c]&&(b[c]=p[c]);this.config=b;this.errors={};this.validFields=[];this.init()}function s(a){return"[object Array]"===Object.prototype.toString.call(a)}function r(a){return"object"===typeof HTMLElement?a instanceof HTMLElement:a&&"object"===typeof a&&null!==a&&1===a.nodeType&&"string"===
typeof a.nodeName}function s(a){return"[object Array]"===Object.prototype.toString.call(a)}function t(){this._thens=[]}var g=function(){},p={completed:g,onFocus:g,onBlur:g,onKeyPress:g,fields:{}};n.prototype={onFieldFocus:function(a){var b=this,c=a.target;b.runLocalHandlers("validations",c).then(function(a){a&&0!=a.length||b.setFieldValid(c)});b.runLocalHandlers("onFocus",c,a)},onFieldBlur:function(a){var b=this,c=a.target;b.runLocalHandlers("validations",c).then(function(a){a&&0!=a.length?0<a.length&&
b.setFieldInvalid(c,a):b.setFieldValid(c)});b.runLocalHandlers("onBlur",c,a)},onFieldKeyUp:function(a){var b=a.target;9!=(a.which||a.keyCode)&&(this.runValidationsDebounced(b),this.runLocalHandlers("onKeyUp",b,a))},onFieldKeyPress:function(a){var b=a.target;this.runValidationsDebounced(b);this.runLocalHandlers("onKeyPress",b,a)},runValidationsDebounced:function(a,b){var c,e,f,d;return function(){f=this;e=[].slice.call(arguments,0);d=new Date;var h=function(){var k=new Date-d;k<b?c=setTimeout(h,b-
k):(c=null,a.apply(f,e))};c||(c=setTimeout(h,b))}}(function(a){var b=this;b.runLocalHandlers("validations",a).then(function(c){c&&0<c.length?b.setFieldInvalid(a,c):b.setFieldValid(a)})},1E3),setFieldInvalid:function(a,b,c){this.errors[a.name||a.id]=b;c=this.validFields.indexOf(a);-1<c&&this.validFields.splice(c,1);this.runLocalHandlers("onError",a,b)},setFieldValid:function(a){var b=this.config;this.runLocalHandlers("onValid",a);delete this.errors[a.name||a.id];-1==this.validFields.indexOf(a)&&this.validFields.push(a);
this.isValid()&&b.completed(a)},getLocalHandlers:function(a){return this.handlers[this.fields.indexOf(a)]},runLocalHandlers:function(a,b,c){var e=new t,f=this.getLocalHandlers(b);if("validations"==a)var d=[];for(var h,k=0;k<f.length;k++){var l=f[k];if("validations"==a){var m=null,g=function(a){d=d.concat(a);e.resolve(d)};"function"===typeof l?m=l(b,g):l[a]&&(m=l[a](b,g));"undefined"===typeof m?h=!0:m&&s(m)&&(d=d.concat(m));h||k!=f.length-1||e.resolve(d)}else if(l[a])l[a](b,c)}return e},isValid:function(a){if(a)return!this.errors.hasOwnProperty(a.id||
a.name);if(this.validFields.length!==this.fields.length)return!1;for(var b in this.errors)if(this.errors.hasOwnProperty(b))return!1;return!0},validate:function(a,b,c){var e=this;"function"!==typeof a&&(a=g);var f=[];if(c&&r(c)&&1<e.fields.indexOf(c))e.runLocalHandlers("validations",c).then(h);else for(var d=0;d<e.fields.length;d++){c=e.fields[d];var h=function(c){return function(d){!0===b&&(d&&0!=d.length?0<d.length&&e.setFieldInvalid(c,d):e.setFieldValid(c));-1==f.indexOf(c)&&f.push(c);f.length==
e.fields.length&&a(e.isValid())}}(c);e.runLocalHandlers("validations",c).then(h)}},init:function(){var a=this;a.fields=[];a.handlers=[];for(var b in a.config.fields)for(var c=Array.prototype.slice.call((a.form||q).querySelectorAll(b)),e=a.config.fields[b],f=0;f<c.length;f++){var d=c[f];-1==a.fields.indexOf(d)?(a.fields.push(d),a.handlers.push([e]),d.addEventListener("focus",function(b){a.onFieldFocus.call(a,b)}),d.addEventListener("blur",function(b){a.onFieldBlur.call(a,b)}),d.addEventListener("keypress",
function(b){a.onFieldKeyPress.call(a,b)}),d.addEventListener("keyup",function(b){a.onFieldKeyUp.call(a,b)})):a.handlers[a.fields.indexOf(c[f])].push(e)}}};"function"==typeof define&&define.amd?define(function(){return n}):"undefined"!==typeof module&&module.exports?module.exports=n:u.ThatValidator=n;t.prototype={then:function(a,b){this._thens.push({resolve:a,reject:b})},resolve:function(a){this._complete("resolve",a)},reject:function(a){this._complete("reject",a)},_complete:function(a,b){this.then=
"resolve"===a?function(a){a&&a(b)}:function(){throw Error("This promise has already been rejected");};for(var c,e=0;c=this._thens[e++];)c[a]&&c[a](b);delete this._thens}}})(window,document);
