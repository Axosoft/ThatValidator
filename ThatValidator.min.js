!function(a,b){"use strict";function c(a,c){var d=this;if(f(a)?d.form=a:"string"==typeof a?d.form=b.querySelector(a):logError("Please pass a valid element or selector"),c||(c=k),"object"==typeof c)for(var e in k)"undefined"==typeof c[e]&&(c[e]=k[e]);d.config=c,d.errors={},d.validFields=[],d.init()}function d(a,c){return Array.prototype.slice.call((c||b).querySelectorAll(a))}function e(a){return"[object Array]"===Object.prototype.toString.call(a)}function f(a){return"object"==typeof HTMLElement?a instanceof HTMLElement:a&&"object"==typeof a&&null!==a&&1===a.nodeType&&"string"==typeof a.nodeName}function g(a){return"function"==typeof a}function h(a,b){var c,d,e,f;return function(){e=this,d=[].slice.call(arguments,0),f=new Date;var g=function(){var h=new Date-f;b>h?c=setTimeout(g,b-h):(c=null,a.apply(e,d))};c||(c=setTimeout(g,b))}}function i(){this._thens=[]}var j=function(){},k={completed:j,onFocus:j,onBlur:j,onKeyPress:j,fields:{}};c.prototype={onFieldFocus:function(a){{var b=this,c=a.target;b.config}b.runLocalHandlers("validations",c).then(function(a){a&&0!=a.length||b.setFieldValid(c)}),b.runLocalHandlers("onFocus",c,a)},onFieldBlur:function(a){{var b=this,c=a.target;b.config}b.runLocalHandlers("validations",c).then(function(a){a&&0!=a.length?a.length>0&&b.setFieldInvalid(c,a):b.setFieldValid(c)}),b.runLocalHandlers("onBlur",c,a)},onFieldKeyUp:function(a){var b=this,c=a.target;9!=(a.which||a.keyCode)&&(b.runValidationsDebounced(c),b.runLocalHandlers("onKeyUp",c,a))},onFieldKeyPress:function(a){var b=this,c=a.target;b.runValidationsDebounced(c),b.runLocalHandlers("onKeyPress",c,a)},runValidationsDebounced:h(function(a){var b=this;b.runLocalHandlers("validations",a).then(function(c){c&&c.length>0?b.setFieldInvalid(a,c):b.setFieldValid(a)})},1e3),setFieldInvalid:function(a,b,c){{var d=this;d.config}d.errors[a.name||a.id]=b;var e=d.validFields.indexOf(a);e>-1&&d.validFields.splice(e,1),d.runLocalHandlers("onError",a,b),d._refilled=!0},setFieldValid:function(a){var b=this,c=b.config;b.runLocalHandlers("onValid",a),delete b.errors[a.name||a.id];var d=b.validFields.indexOf(a);-1==d&&b.validFields.push(a),b.isValid()&&b._refilled&&(c.completed(a),b._refilled=!1)},getLocalHandlers:function(a){var b=this;return b.handlers[b.fields.indexOf(a)]},runLocalHandlers:function(a,b,c){var d=this,f=new i,h=d.getLocalHandlers(b);if("validations"==a)var j=[];for(var k,l=0;l<h.length;l++){var m=h[l];if("validations"==a){var n=null,o=function(a){j=j.concat(a),f.resolve(j)};g(m)?n=m(b,o):m[a]&&(n=m[a](b,o)),"undefined"==typeof n?k=!0:n&&e(n)&&(j=j.concat(n)),k||l!=h.length-1||f.resolve(j)}else m[a]&&m[a](b,c)}return f},isValid:function(a){var b=this;if(a)return!b.errors.hasOwnProperty(a.id||a.name);if(b.validFields.length!==b.fields.length)return!1;for(var c in b.errors)if(b.errors.hasOwnProperty(c))return!1;return!0},validate:function(a,b,c){var d=this;g(a)||(a=K);var e=[];if(c&&f(c)&&d.fields.indexOf(c)>1)d.runLocalHandlers("validations",c).then(i);else for(var h=0;h<d.fields.length;h++){var c=d.fields[h],i=function(c){return function(f){b===!0&&(f&&0!=f.length?f.length>0&&d.setFieldInvalid(c,f):d.setFieldValid(c)),-1==e.indexOf(c)&&e.push(c),e.length==d.fields.length&&a(d.isValid())}}(c);d.runLocalHandlers("validations",c).then(i)}},init:function(){var a=this;a.fields=[],a.handlers=[];for(var b in a.config.fields)for(var c=d(b,a.form),e=a.config.fields[b],f=0;f<c.length;f++){var g=c[f];-1==a.fields.indexOf(g)?(a.fields.push(g),a.handlers.push([e]),g.addEventListener("focus",function(b){a.onFieldFocus.call(a,b)}),g.addEventListener("blur",function(b){a.onFieldBlur.call(a,b)}),g.addEventListener("keypress",function(b){a.onFieldKeyPress.call(a,b)}),g.addEventListener("keyup",function(b){a.onFieldKeyUp.call(a,b)})):a.handlers[a.fields.indexOf(c[f])].push(e)}}},"function"==typeof define&&define.amd?define(function(){return c}):"undefined"!=typeof module&&module.exports?module.exports=c:a.ThatValidator=c,i.prototype={then:function(a,b){this._thens.push({resolve:a,reject:b})},resolve:function(a){this._complete("resolve",a)},reject:function(a){this._complete("reject",a)},_complete:function(a,b){this.then="resolve"===a?function(a){a&&a(b)}:function(){throw new Error("This promise has already been rejected")};for(var c,d=0;c=this._thens[d++];)c[a]&&c[a](b);delete this._thens}}}(window,document);